# Quick Supabase Setup

## 1. Get Your Supabase Connection String

1. Go to your Supabase project dashboard
2. Settings → Database
3. Copy "Connection string" → "URI"
4. Format: `postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres`

**Or use Transaction Pooler (recommended for serverless):**
- Go to "Connection pooling" tab
- Copy "Connection string" → "URI" from Transaction pooler section
- This handles connection pooling better for serverless functions

## 2. Update Environment Variables

### Backend (Railway/Render):
```
DATABASE_URL=[Your Supabase connection string]
SECRET_KEY=[Generate: openssl rand -hex 32]
CORS_ORIGINS=https://your-vercel-app.vercel.app
```

### Frontend (Vercel):
```
VITE_API_URL=https://your-backend.railway.app
```

## 3. Run Migrations

**Option A: Via Alembic (recommended)**
```bash
cd backend
source venv/bin/activate
alembic upgrade head
python scripts/seed_database.py
```

**Option B: Direct SQL (if Alembic issues)**
1. Go to Supabase SQL Editor
2. Run table creation SQL (from migrations)

## 4. Verify Tables

Supabase Dashboard → Table Editor → Should see:
- users
- foods
- exercises
- muscle_groups
- daily_protocols
- workout_plans
- workout_logs
- soreness_records
- compliance_records
- weight_records
- research_studies

## 5. Test Connection

```bash
cd backend
source venv/bin/activate
python -c "from app.core.database import engine; engine.connect(); print('✅ Connected!')"
```

## Common Issues

**Connection timeout:**
- Use Transaction Pooler connection string (port 6543) instead of direct (port 5432)
- Supabase pooler handles connections better for serverless

**SSL required:**
- Supabase requires SSL. SQLAlchemy handles this automatically with `psycopg2-binary`
- If issues, add `?sslmode=require` to connection string

**IP restrictions:**
- Supabase allows all IPs by default
- If restricted, add Railway/Render IPs to allowlist

## Next: Deploy Backend & Frontend

See `DEPLOYMENT_SUPABASE.md` for full deployment steps.

